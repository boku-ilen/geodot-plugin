<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geodot Plugin: geodot-plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Geodot Plugin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">geodot-plugin </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><img src="https://github.com/boku-ilen/geodot-plugin/blob/master/demo/icon.png" alt="" align="right" width="256" height="256" class="inline"/></p>
<p >A Godot plugin for loading geospatial data. Written as a GDExtension with C++ and GDAL.</p>
<p >Various types of Raster and Vector data can be loaded from georeferenced files and used in Godot. One might load a heightmap from a GeoTIFF, building footprints from a Shapefile, or an entire database of data from a GeoPackage. Thanks to efficient filtering and cropping, data can be loaded in real-time.</p>
<p >Automated builds of the addon with an included demo can be found <a href="https://github.com/boku-ilen/geodot-plugin/actions">in the GitHub Actions tab</a>. The <code>master</code> branch is a GDExtension plugin for Godot 4.x. For Godot 3.x with GDNative, use the <code>godot3</code> branch and its builds.</p>
<p >Documentation generated via Doxygen can be found here: <a href="https://boku-ilen.github.io/geodot-plugin/">https://boku-ilen.github.io/geodot-plugin/</a></p>
<p >Feel free to join our Discord for talking about geospatial Godot: <a href="https://discord.gg/MhB5sG7czF">https://discord.gg/MhB5sG7czF</a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Usage</h1>
<p >The included Godot project offers various demo scenes - we recommend looking through that code to get started. Just do give you an idea, this is how you would load a heightmap at a given position and size:</p>
<div class="fragment"><div class="line">var heightmap_data = Geodot.get_raster_layer(&quot;/path/to/data.tif&quot;)</div>
<div class="line"> </div>
<div class="line">var img = heightmap_data.get_image(</div>
<div class="line">    pos_x,</div>
<div class="line">    pos_y,</div>
<div class="line">    size_meters,</div>
<div class="line">    resolution,</div>
<div class="line">    1</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">var texture = img.get_image_texture()</div>
</div><!-- fragment --><p >An Array of Vector features near a given position can be loaded like this:</p>
<div class="fragment"><div class="line">var dataset = Geodot.get_dataset(&quot;/path/to/data.gpkg&quot;)</div>
<div class="line">var layer = dataset.get_feature_layer(&quot;layername&quot;)</div>
<div class="line">    </div>
<div class="line">var features = layer.get_features_near_position(pos_x, pos_y, radius, max_features)</div>
</div><!-- fragment --><p ><b>If you want to add the Geodot addon to your own game</b>, copy the <code>addons/geodot</code> directory to your project.</p>
<p ><b>You will need some sort of geodata to use this plugin.</b> The bundled demo scenes include small snippets of example data such as a raster heightmap and a vector street dataset.</p>
<p ><b>Note:</b> We recommend running the Godot editor with a terminal window attached, since GDAL likes to print error output to <code>stdout</code> which does not show up in the editor itself.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Building</h1>
<p >For building this project we need to install <a href="https://scons.org">Scons</a> by following one of the <a href="https://scons.org/documentation.html">User Guide</a> <em>Installing Scons</em> which is both used for Godot GDExtension and this project and we need the GDAL library which has different installation instruction listed below.</p>
<ul>
<li>Linux</li>
<li>Windows</li>
<li>MacOS</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Building on Linux</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
Preparation</h3>
<ol type="1">
<li>Install GDAL. (With apt: <code>sudo apt install libgdal-dev</code>)</li>
<li>Initialize all git submodules: <code>git submodule update --init --recursive</code></li>
<li>Generate the GDExtension C++ bindings: <code>cd godot-cpp; scons platform=linux generate_bindings=yes</code></li>
</ol>
<h3><a class="anchor" id="autotoc_md5"></a>
Compiling</h3>
<p >Everything is built via SConstruct. Running <code>scons platform=linux</code> in the root directory will compile everything: First the processing libraries, then the finished GDExtension plugin.</p>
<p >If you're working on a processing library, you can also only compile this library with the same <code>scons platform=linux</code> command in that library's directory (e.g. in <code>src/raster-tile-extractor</code>).</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Packaging</h3>
<p >For building a self-contained plugin for use in other projects, it is recommended to move <code>libgdal</code> into the same directory as <code>libgeodot</code> and the other libraries (<code>demo/addons/geodot/x11/</code>).</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Building on Windows</h2>
<p >Because of very inconsistent results with native Visual Studio compilation, we use Docker to create Windows builds from a Linux environment using MinGW. This means that Windows builds are also created on a Linux machine. We recommend the following process <b>on Linux or on WSL</b> (they will not work on native Windows):</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Preparation</h3>
<ol type="1">
<li>Install Docker, SCons, and MinGW</li>
<li>Initialize all git submodules: <code>git submodule update --init --recursive</code></li>
<li>Generate the GDExtension C++ bindings: <code>cd godot-cpp; scons platform=windows generate_bindings=yes</code></li>
<li>Create the build container: <code>docker build -f DockerfileMinGW -t gdal-mingw .</code></li>
</ol>
<h3><a class="anchor" id="autotoc_md9"></a>
Compiling</h3>
<p >Build Geodot on the container: <code>docker run --name mingw-builder gdal-mingw:latest</code></p>
<h3><a class="anchor" id="autotoc_md10"></a>
Packaging</h3>
<p >Copy the resulting Geodot library: <code>docker cp mingw-builder:/geodot/demo/addons/geodot/win64 ./demo/addons/geodot</code></p>
<p >Copy the DLLs for GDAL and all dependencies: <code>docker cp mingw-builder:/usr/x86_64-w64-mingw32/sys-root/mingw/bin ./tmp</code> and <code>cp ./tmp/*.dll ./demo/addons/geodot/win64/</code></p>
<h2><a class="anchor" id="autotoc_md11"></a>
Building on MacOS</h2>
<h3><a class="anchor" id="autotoc_md12"></a>
Notes</h3>
<ul>
<li>The current implementation only has support for x86 and <b>not for</b> the new M1 processor.</li>
<li><a class="el" href="classVectorExtractor.html">VectorExtractor</a> is causing the game to crash. See #51</li>
<li>You have to move some generated files. See #52</li>
</ul>
<h3><a class="anchor" id="autotoc_md13"></a>
Preparation</h3>
<ol type="1">
<li>Install using <code>brew install gdal</code> or manually <a href="https://github.com/OSGeo/gdal">https://github.com/OSGeo/gdal</a>.<ol type="a">
<li>Check installation with ie <code>gdalinfo --formats</code></li>
</ol>
<ol type="a">
<li>Use &lsquo;brew info gdal | grep &rsquo;/usr/local' | cut -d ' ' -f 1<code>or</code>which gdalinfo<code>to find the GDAL install location.</code></li>
</ol>
<ol type="a">
<li><code>Make a note of this path like</code>/usr/local/Cellar/gdal/3.2.1<code>and use that below for</code>osgeo_path=...<code></code></li>
</ol>
</li>
</ol>
<ol type="1">
<li><code>Initialize all git submodules:</code>git submodule update &ndash;init &ndash;recursive`</li>
</ol>
<ol type="1">
<li>Generate the GDExtension C++ bindings: <div class="fragment"><div class="line">cd godot-cpp</div>
<div class="line">scons generate_bindings=yes target=release --jobs=$(sysctl -n hw.logicalcpu)</div>
<div class="line">cd ..</div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="autotoc_md14"></a>
Compiling</h3>
<ol type="1">
<li>Compile the project itself using the GDAL location like <code>scons target=release osgeo_path=/usr/local/Cellar/gdal/3.2.1</code><ol type="a">
<li>This generates the file <code>libgeodot.dylib</code> and 2 more located in <code>demo/addons/geodot/macos</code></li>
</ol>
</li>
</ol>
<ol type="1">
<li>Move the files <code>libRasterTileExtractor.dylib</code> and <code>libVectorExtractor.dylib</code> from <code>demo/addons/geodot/macos</code> into <code>demo/build</code> directory. See #52<ol type="a">
<li><code>mkdir build ; mv demo/addons/geodot/macos/libRasterTileExtractor.dylib demo/addons/geodot/macos/libVectorExtractor.dylib demo/build</code></li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md15"></a>
Developing</h1>
<p >We recommend VSCodium for developing. For on-the-fly code completion, error reporting, etc., install the <code>clangd</code> extension in VSCodium and run <code>scons compiledb=yes</code> in order to generate the required compilation database.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Project structure</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Demo</h2>
<p >A minimal Godot project which the plugin is compiled into by default. Used to test its functionality.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
godot-cpp</h2>
<p >Git submodule with everything that's required for building a GDExtension plugin with C++.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Geodot</h2>
<p ><code>geodot.h</code>, <code><a class="el" href="geodata_8h_source.html">geodata.h</a></code>, etc. - the GDExtension C++ code for the actual plugin. It mainly acts as an interface from Godot-compatible types to custom libraries and classes - it is kept as simple as possible so that adapting it to changes in Godot is easy.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Processing Libraries</h2>
<p >Processing Libraries handle calls to external libraries and convert the results to generic custom classes (independent and unaware of Godot). This way, Godot and external libraries are decoupled, with only one dependency per project.</p>
<p >The reason for this layer of abstraction is ease of compilation and extendibility: The libraries can remain the same, only the core Geodot must be kept consistent with Godot. Similarly, changes in external libraries only affect the corresponding processing library, not the Geodot layer.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
RasterTileExtractor</h3>
<p >Processing library called by Geodot. Wraps GDAL's Raster functionality, primarily the extraction of Raster data into an array.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
VectorExtractor</h3>
<p >Another processing library like the <a class="el" href="classRasterTileExtractor.html">RasterTileExtractor</a>. Also uses GDAL internally, but for vector data functionality, as well as general database and layer handling.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Contributing</h1>
<p >Help is greatly appreciated! You can test and report bugs, fix known <a href="https://github.com/boku-ilen/geodot-plugin/issues">issues</a> or submit new functionality.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Adding a new feature</h2>
<ul>
<li>Actual processing code and external library calls should be put into a separate project (a processing library) which compiles to a library and is independent from Godot.</li>
<li>Geodot should only translate Godot calls and types to calls to this custom library. Its only dependencies should be Godot and custom libraries.</li>
</ul>
<p >Summed up, dependencies should only go in this direction: Godot + Geodot -&gt; Processing Library -&gt; External Libraries</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Credits</h1>
<p >The provided Linux build ships with libgdal.so, a build of the GDAL library. All credits for this library go to <a href="https://github.com/OSGeo/gdal/">OSGeo/gdal</a> (<a href="https://raw.githubusercontent.com/OSGeo/gdal/master/gdal/LICENSE.TXT">license</a>).</p>
<p >The RasterDemo ships with a small sample of <a href="https://data.wien.gv.at/">Viennese test data</a> (CC BY 4.0); the VectorDemo uses a sample of edges from the <a href="http://www.gip.gv.at/#ogd">GIP dataset</a> (CC BY 4.0). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
